<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Mini Netflix Clone</title>
<style>
  /* RESET */
  * {
    margin: 0; padding: 0; box-sizing: border-box;
  }
  body {
    background: #141414;
    color: #fff;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    overflow-x: hidden;
  }
  a {
    color: inherit;
    text-decoration: none;
  }
  /* HEADER */
  header {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 60px;
    background: #141414;
    display: flex;
    align-items: center;
    padding: 0 30px;
    z-index: 1000;
    border-bottom: 1px solid #333;
  }
  header .logo {
    font-weight: 900;
    font-size: 28px;
    color: #e50914;
    letter-spacing: 3px;
    user-select: none;
  }
  header .search-container {
    margin-left: auto;
    position: relative;
  }
  header input[type="text"] {
    width: 220px;
    padding: 7px 12px;
    border-radius: 20px;
    border: none;
    font-size: 14px;
    background: #333;
    color: #fff;
    transition: width 0.3s ease;
  }
  header input[type="text"]:focus {
    outline: none;
    width: 300px;
  }
  header button.search-btn {
    position: absolute;
    right: 4px; top: 50%;
    transform: translateY(-50%);
    background: #e50914;
    border: none;
    padding: 6px 14px;
    border-radius: 15px;
    cursor: pointer;
    font-weight: 700;
    color: white;
  }

  /* MAIN CONTENT */
  main {
    padding: 80px 20px 40px;
    max-width: 1300px;
    margin: 0 auto;
  }
  h2.section-title {
    margin: 20px 0 10px 10px;
    font-weight: 700;
  }

  /* CAROUSEL */
  .carousel {
    display: flex;
    overflow-x: auto;
    gap: 12px;
    padding-bottom: 10px;
    scroll-behavior: smooth;
  }
  .carousel::-webkit-scrollbar {
    height: 8px;
  }
  .carousel::-webkit-scrollbar-thumb {
    background: #e50914;
    border-radius: 4px;
  }
  .card {
    min-width: 150px;
    border-radius: 8px;
    background: #222;
    box-shadow: 0 0 8px rgba(229,9,20,0.5);
    cursor: pointer;
    overflow: hidden;
    transition: transform 0.3s ease;
  }
  .card:hover {
    transform: scale(1.1);
    box-shadow: 0 0 20px #e50914;
    z-index: 10;
  }
  .card img {
    width: 100%;
    height: 220px;
    object-fit: cover;
  }
  .card .title {
    padding: 8px 6px;
    font-size: 14px;
    font-weight: 600;
    text-align: center;
    height: 40px;
    overflow: hidden;
  }

  /* MODALE */
  .modal-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1500;
    padding: 20px;
  }
  .modal {
    background: #1c1c1c;
    max-width: 900px;
    width: 100%;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 0 30px #e50914;
    display: flex;
    flex-direction: column;
  }
  .modal-header {
    display: flex;
    justify-content: flex-end;
    padding: 10px;
  }
  .modal-header button.close-btn {
    background: transparent;
    border: none;
    font-size: 30px;
    color: #fff;
    cursor: pointer;
  }
  .modal-body {
    padding: 20px;
    color: #eee;
  }
  .modal-body h3 {
    margin-bottom: 10px;
  }
  .modal-body p {
    margin-bottom: 15px;
    line-height: 1.4;
    font-size: 15px;
  }
  .modal-body label {
    font-weight: 700;
    margin-right: 6px;
  }
  .modal-body select {
    background: #333;
    border: none;
    border-radius: 6px;
    color: #fff;
    padding: 6px 10px;
    margin-right: 12px;
    font-size: 14px;
  }
  .modal-body button.play-btn {
    background: #e50914;
    border: none;
    color: white;
    padding: 10px 24px;
    font-weight: 700;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 10px;
  }
  .modal-body iframe {
    width: 100%;
    height: 480px;
    border: none;
    margin-top: 20px;
    border-radius: 12px;
  }

  /* MOBILE */
  @media (max-width: 700px) {
    .card {
      min-width: 120px;
    }
    .card img {
      height: 160px;
    }
    header {
      padding: 0 15px;
    }
    header input[type="text"] {
      width: 140px;
    }
    header input[type="text"]:focus {
      width: 180px;
    }
    .modal-body iframe {
      height: 240px;
    }
  }
</style>
</head>
<body>

<header>
  <div class="logo">NETFLIX</div>
  <div class="search-container">
    <input type="text" id="searchInput" placeholder="Cerca film o serie..." autocomplete="off" />
    <button class="search-btn" id="searchBtn">Cerca</button>
  </div>
</header>

<main>
  <section>
    <h2 class="section-title">Trending</h2>
    <div class="carousel" id="trendingCarousel"></div>
  </section>
  <section>
    <h2 class="section-title">Top Rated Movies</h2>
    <div class="carousel" id="topRatedCarousel"></div>
  </section>
  <section>
    <h2 class="section-title">Popular TV Shows</h2>
    <div class="carousel" id="popularTVCarsousel"></div>
  </section>
</main>

<!-- Modale -->
<div id="modalOverlay" class="modal-overlay" style="display:none;">
  <div class="modal">
    <div class="modal-header">
      <button class="close-btn" id="modalCloseBtn">&times;</button>
    </div>
    <div class="modal-body" id="modalBody">
      <!-- Contenuto dinamico -->
    </div>
  </div>
</div>

<script>
  const tmdbApiKey = 'a3c17d492a24a9f77acb23626404edd1';
  const imageBaseURL = 'https://image.tmdb.org/t/p/w500';

  // Utility per normalizzare testo (elimina spazi, minuscole)
  function normalizeText(str) {
    return str.toLowerCase().replace(/\s+/g, '');
  }

  // Fetch helper
  async function fetchJSON(url) {
    const res = await fetch(url);
    if (!res.ok) throw new Error('Errore caricamento dati');
    return res.json();
  }

  // Crea una card film/serie
  function createCard(item) {
    const div = document.createElement('div');
    div.className = 'card';
    const title = item.title || item.name;
    const poster = item.poster_path ? imageBaseURL + item.poster_path : 'https://via.placeholder.com/300x450?text=No+Image';
    div.innerHTML = `
      <img src="${poster}" alt="${title}" />
      <div class="title">${title}</div>
    `;
    div.addEventListener('click', () => openModal(item));
    return div;
  }

  // Carica e mostra sezioni
  async function loadSections() {
    try {
      const trending = await fetchJSON(`https://api.themoviedb.org/3/trending/all/week?api_key=${tmdbApiKey}&language=it-IT`);
      const topRated = await fetchJSON(`https://api.themoviedb.org/3/movie/top_rated?api_key=${tmdbApiKey}&language=it-IT`);
      const popularTV = await fetchJSON(`https://api.themoviedb.org/3/tv/popular?api_key=${tmdbApiKey}&language=it-IT`);

      const trendingContainer = document.getElementById('trendingCarousel');
      const topRatedContainer = document.getElementById('topRatedCarousel');
      const popularTVContainer = document.getElementById('popularTVCarsousel');

      trending.results.forEach(item => trendingContainer.appendChild(createCard(item)));
      topRated.results.forEach(item => topRatedContainer.appendChild(createCard(item)));
      popularTV.results.forEach(item => popularTVContainer.appendChild(createCard(item)));

    } catch (err) {
      console.error(err);
    }
  }

  // Apri modale con dettagli e player
  async function openModal(item) {
    const modal = document.getElementById('modalOverlay');
    const modalBody = document.getElementById('modalBody');

    // Recupera dettagli completi
    const type = item.media_type || (item.title ? 'movie' : 'tv');
    const details = await fetchJSON(`https://api.themoviedb.org/3/${type}/${item.id}?api_key=${tmdbApiKey}&language=it-IT&append_to_response=videos,credits`);

    let seasonsOptionsHTML = '';
    let episodesOptionsHTML = '';
    let selectedSeason = 1;
    let selectedEpisode = 1;

    if (type === 'tv' && details.seasons) {
      // Escludi season 0 (speciali)
      seasonsOptionsHTML = details.seasons.filter(s => s.season_number > 0)
        .map(s => `<option value="${s.season_number}">Stagione ${s.season_number}</option>`).join('');
      // Carica episodi prima stagione
      const seasonData = await fetchJSON(`https://api.themoviedb.org/3/tv/${details.id}/season/1?api_key=${tmdbApiKey}&language=it-IT`);
      episodesOptionsHTML = seasonData.episodes.map(ep => `<option value="${ep.episode_number}">Episodio ${ep.episode_number} - ${ep.name}</option>`).join('');
    }

    // Attori top 5
    const cast = details.credits?.cast?.slice(0,5).map(a => a.name).join(', ') || 'N/A';

    // Trailer Youtube (primo trailer)
    const trailer = details.videos?.results?.find(v => v.type === 'Trailer' && v.site === 'YouTube');

    modalBody.innerHTML = `
      <h3>${type === 'movie' ? details.title : details.name}</h3>
      <p>${details.overview || 'Nessuna descrizione disponibile.'}</p>
      <p><strong>Attori:</strong> ${cast}</p>
      ${type === 'tv' ? `
        <label>Stagione:</label>
        <select id="seasonSelect">${seasonsOptionsHTML}</select>
        <label>Episodio:</label>
        <select id="episodeSelect">${episodesOptionsHTML}</select>
      ` : ''}
      <button class="play-btn">â–¶ Riproduci</button>
      ${trailer ? `<button class="play-btn" id="trailerBtn">ðŸŽ¬ Trailer</button>` : ''}
      <div id="playerContainer"></div>
    `;

    modal.style.display = 'flex';

    // Season change listener
    if(type === 'tv') {
      const seasonSelect = document.getElementById('seasonSelect');
      const episodeSelect = document.getElementById('episodeSelect');
      seasonSelect.addEventListener('change', async () => {
        selectedSeason = +seasonSelect.value;
        const seasonData = await fetchJSON(`https://api.themoviedb.org/3/tv/${details.id}/season/${selectedSeason}?api_key=${tmdbApiKey}&language=it-IT`);
        episodesOptionsHTML = seasonData.episodes.map(ep => `<option value="${ep.episode_number}">Episodio ${ep.episode_number} - ${ep.name}</option>`).join('');
        episodeSelect.innerHTML = episodesOptionsHTML;
        selectedEpisode = seasonData.episodes[0]?.episode_number || 1;
      });
      episodeSelect.addEventListener('change', () => {
        selectedEpisode = +episodeSelect.value;
      });
    }

    // Play button
    modalBody.querySelector('.play-btn').addEventListener('click', () => {
      const playerDiv = document.getElementById('playerContainer');
      playerDiv.innerHTML = ''; // reset

      let url;
      if(type === 'movie') {
        url = `https://vixsrc.to/movie/${details.id}`;
      } else {
        url = `https://vixsrc.to/tv/${details.id}/${selectedSeason}/${selectedEpisode}`;
      }
      playerDiv.innerHTML = `<iframe src="${url}" allowfullscreen allow="autoplay" frameborder="0"></iframe>`;

      // Scroll down to player
      playerDiv.scrollIntoView({behavior:'smooth'});
    });

    // Trailer button
    const trailerBtn = document.getElementById('trailerBtn');
    if(trailerBtn) {
      trailerBtn.addEventListener('click', () => {
        window.open(`https://www.youtube.com/watch?v=${trailer.key}`, '_blank');
      });
    }
  }

  // Chiudi modale
  document.getElementById('modalCloseBtn').addEventListener('click', () => {
    const modal = document.getElementById('modalOverlay');
    modal.style.display = 'none';
    document.getElementById('modalBody').innerHTML = '';
  });

  // Cerca film/serie nel trending + top rated + tv popular
  async function searchMovies() {
    const queryRaw = document.getElementById('searchInput').value.trim();
    if(!queryRaw) return;

    const query = encodeURIComponent(queryRaw);
    const searchUrl = `https://api.themoviedb.org/3/search/multi?api_key=${tmdbApiKey}&language=it-IT&query=${query}&include_adult=false`;

    try {
      const data = await fetchJSON(searchUrl);
      const main = document.querySelector('main');
      main.innerHTML = `<h2 class="section-title">Risultati per: "${queryRaw}"</h2>`;

      const carousel = document.createElement('div');
      carousel.className = 'carousel';

      if(data.results.length === 0) {
        main.innerHTML += '<p style="padding:10px 15px;">Nessun risultato trovato.</p>';
        return;
      }

      data.results.forEach(item => {
        carousel.appendChild(createCard(item));
      });

      main.appendChild(carousel);
    } catch(e) {
      console.error(e);
    }
  }

  document.getElementById('searchBtn').addEventListener('click', searchMovies);
  document.getElementById('searchInput').addEventListener('keydown', (e) => {
    if(e.key === 'Enter') searchMovies();
  });

  // Inizializza app
  loadSections();
</script>

</body>
</html>
